import math
import numpy as np

def calcgrad(guess,original,GradE,sig,Lz,Lt,ks,kt,q0,z,t,s,alpha,beta,gamma,a,b,c,Q1,Q2,Q3,Q4,Q5):
    ws = 1e6
    dz = 1
    dt = 1

    #Calculate Bulk Gradient Energy Term and Elastic Energy Terms
    for t in range(1, Lt-2):
        for z in range(1,Lz-2):
            if z == 0:
                GradE[5*t*Lz + 5*z] = (dt*dz*(16*c*Q1[0,t-1]**3 + 16*c*Q1[0,t]**3 - 8*a*Q1[0,t+1] + (9*ks*Q1[0,t+1])/dz**2 + (9*kt*Q1[0,t+1])/dz**2 + 16*c*Q1[0,t+1]**3 +\
                                 (3*ks*Q1[0,t])/dt**2 + (3*kt*Q1[0,t])/dt**2 - (12*ks*Q1[1,t-1])/dz**2 - (12*kt*Q1[1,t-1])/dz**2 - (12*ks*Q1[1,t])/dz**2 - \
                                 (12*kt*Q1[1,t])/dz**2 - (12*ks*Q1[1,t+1])/dz**2 - (12*kt*Q1[1,t+1])/dz**2 + (3*ks*Q1[2,t-1])/dz**2 + (3*kt*Q1[2,t-1])/dz**2 + \
                                 (3*ks*Q1[2,t])/dz**2 + (3*kt*Q1[2,t])/dz**2 + (3*ks*Q1[2,t+1])/dz**2 + (3*kt*Q1[2,t+1])/dz**2 - (3*ks*Q1[2,t])/dt**2 - \
                                 (3*kt*Q1[2,t])/dt**2 + 16*c*Q1[0,t+1]*Q2[0,t+1]**2 - 4*b*(Q2[0,t-1]**2 + Q2[0,t]**2 + Q2[0,t+1]**2) - (16*kt*q0*Q2[1,t-1])/dz - \
                                 (16*kt*q0*Q2[1,t])/dz - (16*kt*q0*Q2[1,t+1])/dz - (12*kt*q0*Q2[1,t])/dt + (4*kt*q0*Q2[2,t-1])/dz + (4*kt*q0*Q2[2,t])/dz + \
                                 (4*kt*q0*Q2[2,t+1])/dz + 16*c*Q1[0,t+1]*Q3[0,t+1]**2 - 4*a*Q4[0,t-1] + (9*ks*Q4[0,t-1])/dz**2 + 24*c*Q1[0,t-1]**2*Q4[0,t-1] + \
                                 8*c*Q2[0,t-1]**2*Q4[0,t-1] + 8*c*Q3[0,t-1]**2*Q4[0,t-1] + 4*b*Q4[0,t-1]**2 + 8*c*Q4[0,t-1]**3 - 4*a*Q4[0,t] + \
                                 (9*ks*Q4[0,t])/dz**2 + 24*c*Q1[0,t]**2*Q4[0,t] + 8*c*Q2[0,t]**2*Q4[0,t] + 8*c*Q3[0,t]**2*Q4[0,t] + 4*b*Q4[0,t]**2 + 8*c*Q4[0,t]**3 - \
                                 4*a*Q4[0,t+1] + (9*ks*Q4[0,t+1])/dz**2 + 8*b*Q1[0,t+1]*Q4[0,t+1] + 24*c*Q1[0,t+1]**2*Q4[0,t+1] + 8*c*Q2[0,t+1]**2*Q4[0,t+1] + \
                                 8*c*Q3[0,t+1]**2*Q4[0,t+1] + 4*b*Q4[0,t+1]**2 + 24*c*Q1[0,t+1]*Q4[0,t+1]**2 + 8*c*Q4[0,t+1]**3 + (3*ks*Q4[0,t])/dt**2 - \
                                 (12*ks*Q4[1,t-1])/dz**2 - (12*ks*Q4[1,t])/dz**2 - (12*ks*Q4[1,t+1])/dz**2 + (3*ks*Q4[2,t-1])/dz**2 + (3*ks*Q4[2,t])/dz**2 + \
                                 (3*ks*Q4[2,t+1])/dz**2 - (3*ks*Q4[2,t])/dt**2 + 4*b*Q5[0,t-1]**2 + 8*c*Q4[0,t-1]*Q5[0,t-1]**2 + \
                                 (Q1[0,t-1]*(9*(ks + kt) - 8*a*dz**2 + 8*dz**2*(b*Q4[0,t-1] + \
                                 c*(2*Q2[0,t-1]**2 + 2*Q3[0,t-1]**2 + 3*Q4[0,t-1]**2 + 2*Q5[0,t-1]**2))))/dz**2 + 4*b*Q5[0,t]**2 + 8*c*Q4[0,t]*Q5[0,t]**2 + \
                                 (Q1[0,t]*(9*(ks + kt) - 8*a*dz**2 + 8*dz**2*(b*Q4[0,t] + c*(2*Q2[0,t]**2 + 2*Q3[0,t]**2 + 3*Q4[0,t]**2 + 2*Q5[0,t]**2))))/dz**2 + \
                                 4*(b + 4*c*Q1[0,t+1] + 2*c*Q4[0,t+1])*Q5[0,t+1]**2))/4.


                GradE[5*t*Lz + 5*z + 1] = (dt*(8*kt*q0*Q1[1,t-1] + 8*kt*q0*Q1[1,t] + 8*kt*q0*Q1[1,t+1] + (6*kt*q0*dz*Q1[1,t])/dt - 2*kt*q0*Q1[2,t-1] - 2*kt*q0*Q1[2,t] - \
                                 2*kt*q0*Q1[2,t+1] + (9*kt*Q2[0,t-1])/dz - 4*a*dz*Q2[0,t-1] - 4*b*dz*Q1[0,t-1]*Q2[0,t-1] + 8*c*dz*Q1[0,t-1]**2*Q2[0,t-1] + \
                                 8*c*dz*Q2[0,t-1]**3 + (9*kt*Q2[0,t])/dz - 4*a*dz*Q2[0,t] - 4*b*dz*Q1[0,t]*Q2[0,t] + 8*c*dz*Q1[0,t]**2*Q2[0,t] + 8*c*dz*Q2[0,t]**3 + \
                                 (9*kt*Q2[0,t+1])/dz - 4*a*dz*Q2[0,t+1] - 4*b*dz*Q1[0,t+1]*Q2[0,t+1] + 8*c*dz*Q1[0,t+1]**2*Q2[0,t+1] + 8*c*dz*Q2[0,t+1]**3 + \
                                 (3*kt*dz*Q2[0,t])/dt**2 - (12*kt*Q2[1,t-1])/dz - (12*kt*Q2[1,t])/dz - (12*kt*Q2[1,t+1])/dz + (3*kt*Q2[2,t-1])/dz + (3*kt*Q2[2,t])/dz + \
                                 (3*kt*Q2[2,t+1])/dz - (3*kt*dz*Q2[2,t])/dt**2 + 8*c*dz*Q2[0,t-1]*Q3[0,t-1]**2 + 8*c*dz*Q2[0,t]*Q3[0,t]**2 + \
                                 8*c*dz*Q2[0,t+1]*Q3[0,t+1]**2 - 4*b*dz*Q2[0,t-1]*Q4[0,t-1] + 8*c*dz*Q1[0,t-1]*Q2[0,t-1]*Q4[0,t-1] + \
                                 8*c*dz*Q2[0,t-1]*Q4[0,t-1]**2 - 4*b*dz*Q2[0,t]*Q4[0,t] + 8*c*dz*Q1[0,t]*Q2[0,t]*Q4[0,t] + 8*c*dz*Q2[0,t]*Q4[0,t]**2 - \
                                 4*b*dz*Q2[0,t+1]*Q4[0,t+1] + 8*c*dz*Q1[0,t+1]*Q2[0,t+1]*Q4[0,t+1] + 8*c*dz*Q2[0,t+1]*Q4[0,t+1]**2 - 8*kt*q0*Q4[1,t-1] - \
                                 8*kt*q0*Q4[1,t] - 8*kt*q0*Q4[1,t+1] - (6*kt*q0*dz*Q4[1,t])/dt + 2*kt*q0*Q4[2,t-1] + 2*kt*q0*Q4[2,t] + 2*kt*q0*Q4[2,t+1] - \
                                 4*b*dz*Q3[0,t-1]*Q5[0,t-1] + 8*c*dz*Q2[0,t-1]*Q5[0,t-1]**2 - 4*b*dz*Q3[0,t]*Q5[0,t] + 8*c*dz*Q2[0,t]*Q5[0,t]**2 - \
                                 4*b*dz*Q3[0,t+1]*Q5[0,t+1] + 8*c*dz*Q2[0,t+1]*Q5[0,t+1]**2))/2.

                GradE[5*t*Lz + 5*z + 2] = (dt*(16*c*dz*Q3[0,t-1]**3 + 16*c*dz*Q3[0,t]**3 + (9*kt*Q3[0,t+1])/dz - 8*a*dz*Q3[0,t+1] + 16*c*dz*Q1[0,t+1]**2*Q3[0,t+1] + \
                                 16*c*dz*Q2[0,t+1]**2*Q3[0,t+1] + 16*c*dz*Q3[0,t+1]**3 + (3*kt*dz*Q3[0,t])/dt**2 - (12*kt*Q3[1,t-1])/dz - (12*kt*Q3[1,t])/dz - \
                                 (12*kt*Q3[1,t+1])/dz + (3*kt*Q3[2,t-1])/dz + (3*kt*Q3[2,t])/dz + (3*kt*Q3[2,t+1])/dz - (3*kt*dz*Q3[2,t])/dt**2 + \
                                 8*b*dz*Q3[0,t+1]*Q4[0,t+1] + 16*c*dz*Q1[0,t+1]*Q3[0,t+1]*Q4[0,t+1] + 16*c*dz*Q3[0,t+1]*Q4[0,t+1]**2 - \
                                 8*b*dz*Q2[0,t-1]*Q5[0,t-1] + (Q3[0,t-1]*(9*kt - 8*a*dz**2 + \
                                 8*dz**2*(b*Q4[0,t-1] + 2*c*(Q1[0,t-1]**2 + Q2[0,t-1]**2 + Q1[0,t-1]*Q4[0,t-1] + Q4[0,t-1]**2 + Q5[0,t-1]**2))))/dz - \
                                 8*b*dz*Q2[0,t]*Q5[0,t] + (Q3[0,t]*(9*kt - 8*a*dz**2 + \
                                 8*dz**2*(b*Q4[0,t] + 2*c*(Q1[0,t]**2 + Q2[0,t]**2 + Q1[0,t]*Q4[0,t] + Q4[0,t]**2 + Q5[0,t]**2))))/dz - 8*b*dz*Q2[0,t+1]*Q5[0,t+1] + \
                                 16*c*dz*Q3[0,t+1]*Q5[0,t+1]**2 - 16*kt*q0*Q5[1,t-1] - 16*kt*q0*Q5[1,t] - 16*kt*q0*Q5[1,t+1] - (12*kt*q0*dz*Q5[1,t])/dt + \
                                 4*kt*q0*Q5[2,t-1] + 4*kt*q0*Q5[2,t] + 4*kt*q0*Q5[2,t+1]))/4.

                GradE[5*t*Lz + 5*z + 3] = (dt*dz*(-4*a*(Q1[0,t-1] + 2*Q4[0,t-1]) + 4*b*(Q1[0,t-1]**2 - Q2[0,t-1]**2 + Q3[0,t-1]**2 + 2*Q1[0,t-1]*Q4[0,t-1]) - \
                                 4*a*(Q1[0,t] + 2*Q4[0,t]) + 4*b*(Q1[0,t]**2 - Q2[0,t]**2 + Q3[0,t]**2 + 2*Q1[0,t]*Q4[0,t]) - 4*a*(Q1[0,t+1] + 2*Q4[0,t+1]) + \
                                 4*b*(Q1[0,t+1]**2 - Q2[0,t+1]**2 + Q3[0,t+1]**2 + 2*Q1[0,t+1]*Q4[0,t+1]) + \
                                 (3*ks*(3*Q1[0,t-1] - 4*Q1[1,t-1] + Q1[2,t-1] + 3*Q4[0,t-1] - 4*Q4[1,t-1] + Q4[2,t-1]))/dz**2 + \
                                 (kt*(16*q0*dz*Q2[1,t-1] - 4*q0*dz*Q2[2,t-1] + 3*(3*Q4[0,t-1] - 4*Q4[1,t-1] + Q4[2,t-1])))/dz**2 + \
                                 (3*ks*(3*Q1[0,t] - 4*Q1[1,t] + Q1[2,t] + 3*Q4[0,t] - 4*Q4[1,t] + Q4[2,t]))/dz**2 + \
                                 (kt*(16*q0*dz*Q2[1,t] - 4*q0*dz*Q2[2,t] + 3*(3*Q4[0,t] - 4*Q4[1,t] + Q4[2,t])))/dz**2 + \
                                 (3*ks*(3*Q1[0,t+1] - 4*Q1[1,t+1] + Q1[2,t+1] + 3*Q4[0,t+1] - 4*Q4[1,t+1] + Q4[2,t+1]))/dz**2 + \
                                 (kt*(16*q0*dz*Q2[1,t+1] - 4*q0*dz*Q2[2,t+1] + 3*(3*Q4[0,t+1] - 4*Q4[1,t+1] + Q4[2,t+1])))/dz**2 + \
                                 (3*ks*(Q1[0,t] - Q1[2,t] + Q4[0,t] - Q4[2,t]))/dt**2 + (3*kt*(4*dt*q0*Q2[1,t] + Q4[0,t] - Q4[2,t]))/dt**2 + \
                                 8*c*(Q1[0,t-1] + 2*Q4[0,t-1])*(Q1[0,t-1]**2 + Q2[0,t-1]**2 + Q3[0,t-1]**2 + Q1[0,t-1]*Q4[0,t-1] + Q4[0,t-1]**2 + \
                                 Q5[0,t-1]**2) + 8*c*(Q1[0,t] + 2*Q4[0,t])*(Q1[0,t]**2 + Q2[0,t]**2 + Q3[0,t]**2 + Q1[0,t]*Q4[0,t] + Q4[0,t]**2 + Q5[0,t]**2) + \
                                 8*c*(Q1[0,t+1] + 2*Q4[0,t+1])*(Q1[0,t+1]**2 + Q2[0,t+1]**2 + Q3[0,t+1]**2 + Q1[0,t+1]*Q4[0,t+1] + Q4[0,t+1]**2 + \
                                 Q5[0,t+1]**2)))/4.

                GradE[5*t*Lz + 5*z + 4] = (dt*(-8*b*dz*Q2[0,t-1]*Q3[0,t-1] - 8*b*dz*Q2[0,t]*Q3[0,t] - 8*b*dz*Q2[0,t+1]*Q3[0,t+1] + \
                                 16*kt*q0*(Q3[1,t-1] + Q3[1,t] + Q3[1,t+1]) + (12*kt*q0*dz*Q3[1,t])/dt - 4*kt*q0*Q3[2,t-1] - 4*kt*q0*Q3[2,t] - 4*kt*q0*Q3[2,t+1] + \
                                 (9*kt*Q5[0,t-1])/dz - 8*a*dz*Q5[0,t-1] + 8*b*dz*Q1[0,t-1]*Q5[0,t-1] + 16*c*dz*Q1[0,t-1]**2*Q5[0,t-1] + \
                                 16*c*dz*Q2[0,t-1]**2*Q5[0,t-1] + 16*c*dz*Q3[0,t-1]**2*Q5[0,t-1] + 16*c*dz*Q1[0,t-1]*Q4[0,t-1]*Q5[0,t-1] + \
                                 16*c*dz*Q4[0,t-1]**2*Q5[0,t-1] + 16*c*dz*Q5[0,t-1]**3 + (9*kt*Q5[0,t])/dz - 8*a*dz*Q5[0,t] + 8*b*dz*Q1[0,t]*Q5[0,t] + \
                                 16*c*dz*Q1[0,t]**2*Q5[0,t] + 16*c*dz*Q2[0,t]**2*Q5[0,t] + 16*c*dz*Q3[0,t]**2*Q5[0,t] + 16*c*dz*Q1[0,t]*Q4[0,t]*Q5[0,t] + \
                                 16*c*dz*Q4[0,t]**2*Q5[0,t] + 16*c*dz*Q5[0,t]**3 + (9*kt*Q5[0,t+1])/dz - 8*a*dz*Q5[0,t+1] + 8*b*dz*Q1[0,t+1]*Q5[0,t+1] + \
                                 16*c*dz*Q1[0,t+1]**2*Q5[0,t+1] + 16*c*dz*Q2[0,t+1]**2*Q5[0,t+1] + 16*c*dz*Q3[0,t+1]**2*Q5[0,t+1] + \
                                 16*c*dz*Q1[0,t+1]*Q4[0,t+1]*Q5[0,t+1] + 16*c*dz*Q4[0,t+1]**2*Q5[0,t+1] + 16*c*dz*Q5[0,t+1]**3 + (3*kt*dz*Q5[0,t])/dt**2 - \
                                 (12*kt*Q5[1,t-1])/dz - (12*kt*Q5[1,t])/dz - (12*kt*Q5[1,t+1])/dz + (3*kt*Q5[2,t-1])/dz + (3*kt*Q5[2,t])/dz + (3*kt*Q5[2,t+1])/dz - \
                                 (3*kt*dz*Q5[2,t])/dt**2))/4.

            elif z == 1:
                GradE[5*t*Lz + 5*z] = (dt*dz*(16*c*Q1[1,t-1]**3 + 16*c*Q1[1,t]**3 - 8*a*Q1[1,t+1] + (9*ks*Q1[1,t+1])/dz**2 + (9*kt*Q1[1,t+1])/dz**2 + 16*c*Q1[1,t+1]**3 + \
                                 (3*ks*Q1[1,t])/dt**2 + (3*kt*Q1[1,t])/dt**2 - (12*ks*Q1[2,t-1])/dz**2 - (12*kt*Q1[2,t-1])/dz**2 - (12*ks*Q1[2,t])/dz**2 - \
                                 (12*kt*Q1[2,t])/dz**2 - (12*ks*Q1[2,t+1])/dz**2 - (12*kt*Q1[2,t+1])/dz**2 + (3*ks*Q1[3,t-1])/dz**2 + (3*kt*Q1[3,t-1])/dz**2 + \
                                 (3*ks*Q1[3,t])/dz**2 + (3*kt*Q1[3,t])/dz**2 + (3*ks*Q1[3,t+1])/dz**2 + (3*kt*Q1[3,t+1])/dz**2 - (3*ks*Q1[3,t])/dt**2 - \
                                 (3*kt*Q1[3,t])/dt**2 + 16*c*Q1[1,t+1]*Q2[1,t+1]**2 - 4*b*(Q2[1,t-1]**2 + Q2[1,t]**2 + Q2[1,t+1]**2) - (16*kt*q0*Q2[2,t-1])/dz - \
                                 (16*kt*q0*Q2[2,t])/dz - (16*kt*q0*Q2[2,t+1])/dz - (12*kt*q0*Q2[2,t])/dt + (4*kt*q0*Q2[3,t-1])/dz + (4*kt*q0*Q2[3,t])/dz + \
                                 (4*kt*q0*Q2[3,t+1])/dz + 16*c*Q1[1,t+1]*Q3[1,t+1]**2 - 4*a*Q4[1,t-1] + (9*ks*Q4[1,t-1])/dz**2 + 24*c*Q1[1,t-1]**2*Q4[1,t-1] + \
                                 8*c*Q2[1,t-1]**2*Q4[1,t-1] + 8*c*Q3[1,t-1]**2*Q4[1,t-1] + 4*b*Q4[1,t-1]**2 + 8*c*Q4[1,t-1]**3 - 4*a*Q4[1,t] + \
                                 (9*ks*Q4[1,t])/dz**2 + 24*c*Q1[1,t]**2*Q4[1,t] + 8*c*Q2[1,t]**2*Q4[1,t] + 8*c*Q3[1,t]**2*Q4[1,t] + 4*b*Q4[1,t]**2 + 8*c*Q4[1,t]**3 - \
                                 4*a*Q4[1,t+1] + (9*ks*Q4[1,t+1])/dz**2 + 8*b*Q1[1,t+1]*Q4[1,t+1] + 24*c*Q1[1,t+1]**2*Q4[1,t+1] + 8*c*Q2[1,t+1]**2*Q4[1,t+1] + \
                                 8*c*Q3[1,t+1]**2*Q4[1,t+1] + 4*b*Q4[1,t+1]**2 + 24*c*Q1[1,t+1]*Q4[1,t+1]**2 + 8*c*Q4[1,t+1]**3 + (3*ks*Q4[1,t])/dt**2 - \
                                 (12*ks*Q4[2,t-1])/dz**2 - (12*ks*Q4[2,t])/dz**2 - (12*ks*Q4[2,t+1])/dz**2 + (3*ks*Q4[3,t-1])/dz**2 + (3*ks*Q4[3,t])/dz**2 + \
                                 (3*ks*Q4[3,t+1])/dz**2 - (3*ks*Q4[3,t])/dt**2 + 4*b*Q5[1,t-1]**2 + 8*c*Q4[1,t-1]*Q5[1,t-1]**2 + \
                                 (Q1[1,t-1]*(9*(ks + kt) - 8*a*dz**2 + 8*dz**2*(b*Q4[1,t-1] + \
                                 c*(2*Q2[1,t-1]**2 + 2*Q3[1,t-1]**2 + 3*Q4[1,t-1]**2 + 2*Q5[1,t-1]**2))))/dz**2 + 4*b*Q5[1,t]**2 + 8*c*Q4[1,t]*Q5[1,t]**2 + \
                                 (Q1[1,t]*(9*(ks + kt) - 8*a*dz**2 + 8*dz**2*(b*Q4[1,t] + c*(2*Q2[1,t]**2 + 2*Q3[1,t]**2 + 3*Q4[1,t]**2 + 2*Q5[1,t]**2))))/dz**2 +\
                                 4*(b + 4*c*Q1[1,t+1] + 2*c*Q4[1,t+1])*Q5[1,t+1]**2))/4.


                GradE[5*t*Lz + 5*z + 1] = (dt*(8*kt*q0*Q1[2,t-1] + 8*kt*q0*Q1[2,t] + 8*kt*q0*Q1[2,t+1] + (6*kt*q0*dz*Q1[2,t])/dt - 2*kt*q0*Q1[3,t-1] - 2*kt*q0*Q1[3,t] - \
                                 2*kt*q0*Q1[3,t+1] + (9*kt*Q2[1,t-1])/dz - 4*a*dz*Q2[1,t-1] - 4*b*dz*Q1[1,t-1]*Q2[1,t-1] + 8*c*dz*Q1[1,t-1]**2*Q2[1,t-1] + \
                                 8*c*dz*Q2[1,t-1]**3 + (9*kt*Q2[1,t])/dz - 4*a*dz*Q2[1,t] - 4*b*dz*Q1[1,t]*Q2[1,t] + 8*c*dz*Q1[1,t]**2*Q2[1,t] + 8*c*dz*Q2[1,t]**3 + \
                                 (9*kt*Q2[1,t+1])/dz - 4*a*dz*Q2[1,t+1] - 4*b*dz*Q1[1,t+1]*Q2[1,t+1] + 8*c*dz*Q1[1,t+1]**2*Q2[1,t+1] + 8*c*dz*Q2[1,t+1]**3 + \
                                 (3*kt*dz*Q2[1,t])/dt**2 - (12*kt*Q2[2,t-1])/dz - (12*kt*Q2[2,t])/dz - (12*kt*Q2[2,t+1])/dz + (3*kt*Q2[3,t-1])/dz + (3*kt*Q2[3,t])/dz + \
                                 (3*kt*Q2[3,t+1])/dz - (3*kt*dz*Q2[3,t])/dt**2 + 8*c*dz*Q2[1,t-1]*Q3[1,t-1]**2 + 8*c*dz*Q2[1,t]*Q3[1,t]**2 + \
                                 8*c*dz*Q2[1,t+1]*Q3[1,t+1]**2 - 4*b*dz*Q2[1,t-1]*Q4[1,t-1] + 8*c*dz*Q1[1,t-1]*Q2[1,t-1]*Q4[1,t-1] + \
                                 8*c*dz*Q2[1,t-1]*Q4[1,t-1]**2 - 4*b*dz*Q2[1,t]*Q4[1,t] + 8*c*dz*Q1[1,t]*Q2[1,t]*Q4[1,t] + 8*c*dz*Q2[1,t]*Q4[1,t]**2 - \
                                 4*b*dz*Q2[1,t+1]*Q4[1,t+1] + 8*c*dz*Q1[1,t+1]*Q2[1,t+1]*Q4[1,t+1] + 8*c*dz*Q2[1,t+1]*Q4[1,t+1]**2 - 8*kt*q0*Q4[2,t-1] - \
                                 8*kt*q0*Q4[2,t] - 8*kt*q0*Q4[2,t+1] - (6*kt*q0*dz*Q4[2,t])/dt + 2*kt*q0*Q4[3,t-1] + 2*kt*q0*Q4[3,t] + 2*kt*q0*Q4[3,t+1] - \
                                 4*b*dz*Q3[1,t-1]*Q5[1,t-1] + 8*c*dz*Q2[1,t-1]*Q5[1,t-1]**2 - 4*b*dz*Q3[1,t]*Q5[1,t] + 8*c*dz*Q2[1,t]*Q5[1,t]**2 - \
                                 4*b*dz*Q3[1,t+1]*Q5[1,t+1] + 8*c*dz*Q2[1,t+1]*Q5[1,t+1]**2))/2.

                GradE[5*t*Lz + 5*z + 2] = (dt*(16*c*dz*Q3[1,t-1]**3 + 16*c*dz*Q3[1,t]**3 + (9*kt*Q3[1,t+1])/dz - 8*a*dz*Q3[1,t+1] + 16*c*dz*Q1[1,t+1]**2*Q3[1,t+1] + \
                                 16*c*dz*Q2[1,t+1]**2*Q3[1,t+1] + 16*c*dz*Q3[1,t+1]**3 + (3*kt*dz*Q3[1,t])/dt**2 - (12*kt*Q3[2,t-1])/dz - (12*kt*Q3[2,t])/dz - \
                                 (12*kt*Q3[2,t+1])/dz + (3*kt*Q3[3,t-1])/dz + (3*kt*Q3[3,t])/dz + (3*kt*Q3[3,t+1])/dz - (3*kt*dz*Q3[3,t])/dt**2 + \
                                 8*b*dz*Q3[1,t+1]*Q4[1,t+1] + 16*c*dz*Q1[1,t+1]*Q3[1,t+1]*Q4[1,t+1] + 16*c*dz*Q3[1,t+1]*Q4[1,t+1]**2 - \
                                 8*b*dz*Q2[1,t-1]*Q5[1,t-1] + (Q3[1,t-1]*(9*kt - 8*a*dz**2 + \
                                 8*dz**2*(b*Q4[1,t-1] + 2*c*(Q1[1,t-1]**2 + Q2[1,t-1]**2 + Q1[1,t-1]*Q4[1,t-1] + Q4[1,t-1]**2 + Q5[1,t-1]**2))))/dz - \
                                 8*b*dz*Q2[1,t]*Q5[1,t] + (Q3[1,t]*(9*kt - 8*a*dz**2 + \
                                 8*dz**2*(b*Q4[1,t] + 2*c*(Q1[1,t]**2 + Q2[1,t]**2 + Q1[1,t]*Q4[1,t] + Q4[1,t]**2 + Q5[1,t]**2))))/dz - 8*b*dz*Q2[1,t+1]*Q5[1,t+1] + \
                                 16*c*dz*Q3[1,t+1]*Q5[1,t+1]**2 - 16*kt*q0*Q5[2,t-1] - 16*kt*q0*Q5[2,t] - 16*kt*q0*Q5[2,t+1] - (12*kt*q0*dz*Q5[2,t])/dt + \
                                 4*kt*q0*Q5[3,t-1] + 4*kt*q0*Q5[3,t] + 4*kt*q0*Q5[3,t+1]))/4.

                GradE[5*t*Lz + 5*z + 3] = (dt*dz*(-4*a*(Q1[1,t-1] + 2*Q4[1,t-1]) + 4*b*(Q1[1,t-1]**2 - Q2[1,t-1]**2 + Q3[1,t-1]**2 + 2*Q1[1,t-1]*Q4[1,t-1]) - \
                                 4*a*(Q1[1,t] + 2*Q4[1,t]) + 4*b*(Q1[1,t]**2 - Q2[1,t]**2 + Q3[1,t]**2 + 2*Q1[1,t]*Q4[1,t]) - 4*a*(Q1[1,t+1] + 2*Q4[1,t+1]) + \
                                 4*b*(Q1[1,t+1]**2 - Q2[1,t+1]**2 + Q3[1,t+1]**2 + 2*Q1[1,t+1]*Q4[1,t+1]) + \
                                 (3*ks*(3*Q1[1,t-1] - 4*Q1[2,t-1] + Q1[3,t-1] + 3*Q4[1,t-1] - 4*Q4[2,t-1] + Q4[3,t-1]))/dz**2 + \
                                 (kt*(16*q0*dz*Q2[2,t-1] - 4*q0*dz*Q2[3,t-1] + 3*(3*Q4[1,t-1] - 4*Q4[2,t-1] + Q4[3,t-1])))/dz**2 + \
                                 (3*ks*(3*Q1[1,t] - 4*Q1[2,t] + Q1[3,t] + 3*Q4[1,t] - 4*Q4[2,t] + Q4[3,t]))/dz**2 + \
                                 (kt*(16*q0*dz*Q2[2,t] - 4*q0*dz*Q2[3,t] + 3*(3*Q4[1,t] - 4*Q4[2,t] + Q4[3,t])))/dz**2 + \
                                 (3*ks*(3*Q1[1,t+1] - 4*Q1[2,t+1] + Q1[3,t+1] + 3*Q4[1,t+1] - 4*Q4[2,t+1] + Q4[3,t+1]))/dz**2 + \
                                 (kt*(16*q0*dz*Q2[2,t+1] - 4*q0*dz*Q2[3,t+1] + 3*(3*Q4[1,t+1] - 4*Q4[2,t+1] + Q4[3,t+1])))/dz**2 + \
                                 (3*ks*(Q1[1,t] - Q1[3,t] + Q4[1,t] - Q4[3,t]))/dt**2 + (3*kt*(4*dt*q0*Q2[2,t] + Q4[1,t] - Q4[3,t]))/dt**2 + \
                                 8*c*(Q1[1,t-1] + 2*Q4[1,t-1])*(Q1[1,t-1]**2 + Q2[1,t-1]**2 + Q3[1,t-1]**2 + Q1[1,t-1]*Q4[1,t-1] + Q4[1,t-1]**2 + \
                                 Q5[1,t-1]**2) + 8*c*(Q1[1,t] + 2*Q4[1,t])*(Q1[1,t]**2 + Q2[1,t]**2 + Q3[1,t]**2 + Q1[1,t]*Q4[1,t] + Q4[1,t]**2 + Q5[1,t]**2) + \
                                 8*c*(Q1[1,t+1] + 2*Q4[1,t+1])*(Q1[1,t+1]**2 + Q2[1,t+1]**2 + Q3[1,t+1]**2 + Q1[1,t+1]*Q4[1,t+1] + Q4[1,t+1]**2 + \
                                 Q5[1,t+1]**2)))/4.

                GradE[5*t*Lz + 5*z + 4] = (dt*(-8*b*dz*Q2[1,t-1]*Q3[1,t-1] - 8*b*dz*Q2[1,t]*Q3[1,t] - 8*b*dz*Q2[1,t+1]*Q3[1,t+1] + \
                                 16*kt*q0*(Q3[2,t-1] + Q3[2,t] + Q3[2,t+1]) + (12*kt*q0*dz*Q3[2,t])/dt - 4*kt*q0*Q3[3,t-1] - 4*kt*q0*Q3[3,t] - 4*kt*q0*Q3[3,t+1] + \
                                 (9*kt*Q5[1,t-1])/dz - 8*a*dz*Q5[1,t-1] + 8*b*dz*Q1[1,t-1]*Q5[1,t-1] + 16*c*dz*Q1[1,t-1]**2*Q5[1,t-1] + \
                                 16*c*dz*Q2[1,t-1]**2*Q5[1,t-1] + 16*c*dz*Q3[1,t-1]**2*Q5[1,t-1] + 16*c*dz*Q1[1,t-1]*Q4[1,t-1]*Q5[1,t-1] + \
                                 16*c*dz*Q4[1,t-1]**2*Q5[1,t-1] + 16*c*dz*Q5[1,t-1]**3 + (9*kt*Q5[1,t])/dz - 8*a*dz*Q5[1,t] + 8*b*dz*Q1[1,t]*Q5[1,t] + \
                                 16*c*dz*Q1[1,t]**2*Q5[1,t] + 16*c*dz*Q2[1,t]**2*Q5[1,t] + 16*c*dz*Q3[1,t]**2*Q5[1,t] + 16*c*dz*Q1[1,t]*Q4[1,t]*Q5[1,t] + \
                                 16*c*dz*Q4[1,t]**2*Q5[1,t] + 16*c*dz*Q5[1,t]**3 + (9*kt*Q5[1,t+1])/dz - 8*a*dz*Q5[1,t+1] + 8*b*dz*Q1[1,t+1]*Q5[1,t+1] + \
                                 16*c*dz*Q1[1,t+1]**2*Q5[1,t+1] + 16*c*dz*Q2[1,t+1]**2*Q5[1,t+1] + 16*c*dz*Q3[1,t+1]**2*Q5[1,t+1] + \
                                 16*c*dz*Q1[1,t+1]*Q4[1,t+1]*Q5[1,t+1] + 16*c*dz*Q4[1,t+1]**2*Q5[1,t+1] + 16*c*dz*Q5[1,t+1]**3 + (3*kt*dz*Q5[1,t])/dt**2 - \
                                 (12*kt*Q5[2,t-1])/dz - (12*kt*Q5[2,t])/dz - (12*kt*Q5[2,t+1])/dz + (3*kt*Q5[3,t-1])/dz + (3*kt*Q5[3,t])/dz + (3*kt*Q5[3,t+1])/dz - \
                                 (3*kt*dz*Q5[3,t])/dt**2))/4.
            # elif z == Lz-1:
            #     er
            #
            # elif z == Lz-2:
            #     er

            else:

                GradE[5*t*Lz + 5*z] = (dz*dt*(kt*q0*(Q2[z-2,t-1] - Q2[z,t-1]) + kt*q0*(Q2[z-2,t] - Q2[z,t]) + kt*q0*(Q2[z-2,t+1] - Q2[z,t+1]) + \
                                kt*q0*(Q2[z-1,t-1] - Q2[z+1,t-1]) + kt*q0*(Q2[z-1,t] - Q2[z+1,t]) + kt*q0*(Q2[z-1,t+1] - Q2[z+1,t+1]) + \
                                kt*q0*(Q2[z,t-1] - Q2[z+2,t-1]) + kt*q0*(Q2[z,t] - Q2[z+2,t]) + kt*q0*(Q2[z,t+1] - Q2[z+2,t+1]) - \
                                a*dt*(2*Q1[z-1,t-1] + Q4[z-1,t-1]) - a*dt*(2*Q1[z-1,t] + Q4[z-1,t]) - a*dt*(2*Q1[z-1,t+1] + Q4[z-1,t+1]) -\
                                a*dt*(2*Q1[z,t-1] + Q4[z,t-1]) - a*dt*(2*Q1[z,t] + Q4[z,t]) - a*dt*(2*Q1[z,t+1] + Q4[z,t+1]) - \
                                a*dt*(2*Q1[z+1,t-1] + Q4[z+1,t-1]) - a*dt*(2*Q1[z+1,t] + Q4[z+1,t]) - a*dt*(2*Q1[z+1,t+1] + Q4[z+1,t+1]) + \
                                2*c*dt*(2*Q1[z-1,t-1] + Q4[z-1,t-1])*(Q1[z-1,t-1]**2 + Q2[z-1,t-1]**2 + Q3[z-1,t-1]**2 + \
                                Q1[z-1,t-1]*Q4[z-1,t-1] + Q4[z-1,t-1]**2 + Q5[z-1,t-1]**2) + \
                                b*dt*(-Q2[z-1,t-1]**2 + 2*Q1[z-1,t-1]*Q4[z-1,t-1] + Q4[z-1,t-1]**2 + Q5[z-1,t-1]**2) + \
                                2*c*dt*(2*Q1[z-1,t] + Q4[z-1,t])*(Q1[z-1,t]**2 + Q2[z-1,t]**2 + Q3[z-1,t]**2 + Q1[z-1,t]*Q4[z-1,t] + Q4[z-1,t]**2 + \
                                Q5[z-1,t]**2) + b*dt*(-Q2[z-1,t]**2 + 2*Q1[z-1,t]*Q4[z-1,t] + Q4[z-1,t]**2 + Q5[z-1,t]**2) + \
                                2*c*dt*(2*Q1[z-1,t+1] + Q4[z-1,t+1])*(Q1[z-1,t+1]**2 + Q2[z-1,t+1]**2 + Q3[z-1,t+1]**2 + \
                                Q1[z-1,t+1]*Q4[z-1,t+1] + Q4[z-1,t+1]**2 + Q5[z-1,t+1]**2) + \
                                b*dt*(-Q2[z-1,t+1]**2 + 2*Q1[z-1,t+1]*Q4[z-1,t+1] + Q4[z-1,t+1]**2 + Q5[z-1,t+1]**2) + \
                                2*c*dt*(2*Q1[z,t-1] + Q4[z,t-1])*(Q1[z,t-1]**2 + Q2[z,t-1]**2 + Q3[z,t-1]**2 + Q1[z,t-1]*Q4[z,t-1] + Q4[z,t-1]**2 + \
                                Q5[z,t-1]**2) + b*dt*(-Q2[z,t-1]**2 + 2*Q1[z,t-1]*Q4[z,t-1] + Q4[z,t-1]**2 + Q5[z,t-1]**2) + \
                                2*c*dt*(2*Q1[z,t] + Q4[z,t])*(Q1[z,t]**2 + Q2[z,t]**2 + Q3[z,t]**2 + Q1[z,t]*Q4[z,t] + Q4[z,t]**2 + Q5[z,t]**2) + \
                                b*dt*(-Q2[z,t]**2 + 2*Q1[z,t]*Q4[z,t] + Q4[z,t]**2 + Q5[z,t]**2) + \
                                2*c*dt*(2*Q1[z,t+1] + Q4[z,t+1])*(Q1[z,t+1]**2 + Q2[z,t+1]**2 + Q3[z,t+1]**2 + Q1[z,t+1]*Q4[z,t+1] + Q4[z,t+1]**2 + \
                                Q5[z,t+1]**2) + b*dt*(-Q2[z,t+1]**2 + 2*Q1[z,t+1]*Q4[z,t+1] + Q4[z,t+1]**2 + Q5[z,t+1]**2) + \
                                2*c*dt*(2*Q1[z+1,t-1] + Q4[z+1,t-1])*(Q1[z+1,t-1]**2 + Q2[z+1,t-1]**2 + Q3[z+1,t-1]**2 + \
                                Q1[z+1,t-1]*Q4[z+1,t-1] + Q4[z+1,t-1]**2 + Q5[z+1,t-1]**2) + \
                                b*dt*(-Q2[z+1,t-1]**2 + 2*Q1[z+1,t-1]*Q4[z+1,t-1] + Q4[z+1,t-1]**2 + Q5[z+1,t-1]**2) + \
                                2*c*dt*(2*Q1[z+1,t] + Q4[z+1,t])*(Q1[z+1,t]**2 + Q2[z+1,t]**2 + Q3[z+1,t]**2 + Q1[z+1,t]*Q4[z+1,t] + Q4[z+1,t]**2 + \
                                Q5[z+1,t]**2) + b*dt*(-Q2[z+1,t]**2 + 2*Q1[z+1,t]*Q4[z+1,t] + Q4[z+1,t]**2 + Q5[z+1,t]**2) + \
                                2*c*dt*(2*Q1[z+1,t+1] + Q4[z+1,t+1])*(Q1[z+1,t+1]**2 + Q2[z+1,t+1]**2 + Q3[z+1,t+1]**2 + Q1[z+1,t+1]*Q4[z+1,t+1] + \
                                Q4[z+1,t+1]**2 + Q5[z+1,t+1]**2) + b*dt*(-Q2[z+1,t+1]**2 + 2*Q1[z+1,t+1]*Q4[z+1,t+1] + Q4[z+1,t+1]**2 + \
                                Q5[z+1,t+1]**2)))/dt

                GradE[5*t*Lz + 5*z + 1] = (dz*dt*(-(kt*q0*Q1[z-2,t-1]) - kt*q0*Q1[z-2,t] - kt*q0*Q1[z-2,t+1] - kt*q0*Q1[z-1,t-1] - kt*q0*Q1[z-1,t] -\
                                 kt*q0*Q1[z-1,t+1] + kt*q0*Q1[z+1,t-1] + kt*q0*Q1[z+1,t] + kt*q0*Q1[z+1,t+1] + kt*q0*Q1[z+2,t-1] + kt*q0*Q1[z+2,t] + \
                                 kt*q0*Q1[z+2,t+1] - 2*a*dt*Q2[z-1,t-1] - 2*b*dt*Q1[z-1,t-1]*Q2[z-1,t-1] + 4*c*dt*Q1[z-1,t-1]**2*Q2[z-1,t-1] +\
                                 4*c*dt*Q2[z-1,t-1]**3 - 2*a*dt*Q2[z-1,t] - 2*b*dt*Q1[z-1,t]*Q2[z-1,t] + 4*c*dt*Q1[z-1,t]**2*Q2[z-1,t] + \
                                 4*c*dt*Q2[z-1,t]**3 - 2*a*dt*Q2[z-1,t+1] - 2*b*dt*Q1[z-1,t+1]*Q2[z-1,t+1] + 4*c*dt*Q1[z-1,t+1]**2*Q2[z-1,t+1] +\
                                 4*c*dt*Q2[z-1,t+1]**3 - 2*a*dt*Q2[z,t-1] - 2*b*dt*Q1[z,t-1]*Q2[z,t-1] + 4*c*dt*Q1[z,t-1]**2*Q2[z,t-1] + \
                                 4*c*dt*Q2[z,t-1]**3 - 2*a*dt*Q2[z,t] - 2*b*dt*Q1[z,t]*Q2[z,t] + 4*c*dt*Q1[z,t]**2*Q2[z,t] + 4*c*dt*Q2[z,t]**3 - 2*a*dt*Q2[z,t+1] - \
                                 2*b*dt*Q1[z,t+1]*Q2[z,t+1] + 4*c*dt*Q1[z,t+1]**2*Q2[z,t+1] + 4*c*dt*Q2[z,t+1]**3 - 2*a*dt*Q2[z+1,t-1] - \
                                 2*b*dt*Q1[z+1,t-1]*Q2[z+1,t-1] + 4*c*dt*Q1[z+1,t-1]**2*Q2[z+1,t-1] + 4*c*dt*Q2[z+1,t-1]**3 - 2*a*dt*Q2[z+1,t] - \
                                 2*b*dt*Q1[z+1,t]*Q2[z+1,t] + 4*c*dt*Q1[z+1,t]**2*Q2[z+1,t] + 4*c*dt*Q2[z+1,t]**3 - 2*a*dt*Q2[z+1,t+1] - \
                                 2*b*dt*Q1[z+1,t+1]*Q2[z+1,t+1] + 4*c*dt*Q1[z+1,t+1]**2*Q2[z+1,t+1] + 4*c*dt*Q2[z+1,t+1]**3 + \
                                 4*c*dt*Q2[z-1,t-1]*Q3[z-1,t-1]**2 + 4*c*dt*Q2[z-1,t]*Q3[z-1,t]**2 + 4*c*dt*Q2[z-1,t+1]*Q3[z-1,t+1]**2 + \
                                 4*c*dt*Q2[z,t-1]*Q3[z,t-1]**2 + 4*c*dt*Q2[z,t]*Q3[z,t]**2 + 4*c*dt*Q2[z,t+1]*Q3[z,t+1]**2 + \
                                 4*c*dt*Q2[z+1,t-1]*Q3[z+1,t-1]**2 + 4*c*dt*Q2[z+1,t]*Q3[z+1,t]**2 + 4*c*dt*Q2[z+1,t+1]*Q3[z+1,t+1]**2 + \
                                 kt*q0*Q4[z-2,t-1] + kt*q0*Q4[z-2,t] + kt*q0*Q4[z-2,t+1] + kt*q0*Q4[z-1,t-1] - 2*b*dt*Q2[z-1,t-1]*Q4[z-1,t-1] + \
                                 4*c*dt*Q1[z-1,t-1]*Q2[z-1,t-1]*Q4[z-1,t-1] + 4*c*dt*Q2[z-1,t-1]*Q4[z-1,t-1]**2 + kt*q0*Q4[z-1,t] - \
                                 2*b*dt*Q2[z-1,t]*Q4[z-1,t] + 4*c*dt*Q1[z-1,t]*Q2[z-1,t]*Q4[z-1,t] + 4*c*dt*Q2[z-1,t]*Q4[z-1,t]**2 + \
                                 kt*q0*Q4[z-1,t+1] - 2*b*dt*Q2[z-1,t+1]*Q4[z-1,t+1] + 4*c*dt*Q1[z-1,t+1]*Q2[z-1,t+1]*Q4[z-1,t+1] + \
                                 4*c*dt*Q2[z-1,t+1]*Q4[z-1,t+1]**2 - 2*b*dt*Q2[z,t-1]*Q4[z,t-1] + 4*c*dt*Q1[z,t-1]*Q2[z,t-1]*Q4[z,t-1] + \
                                 4*c*dt*Q2[z,t-1]*Q4[z,t-1]**2 - 2*b*dt*Q2[z,t]*Q4[z,t] + 4*c*dt*Q1[z,t]*Q2[z,t]*Q4[z,t] + 4*c*dt*Q2[z,t]*Q4[z,t]**2 - \
                                 2*b*dt*Q2[z,t+1]*Q4[z,t+1] + 4*c*dt*Q1[z,t+1]*Q2[z,t+1]*Q4[z,t+1] + 4*c*dt*Q2[z,t+1]*Q4[z,t+1]**2 - kt*q0*Q4[z+1,t-1] - \
                                 2*b*dt*Q2[z+1,t-1]*Q4[z+1,t-1] + 4*c*dt*Q1[z+1,t-1]*Q2[z+1,t-1]*Q4[z+1,t-1] + \
                                 4*c*dt*Q2[z+1,t-1]*Q4[z+1,t-1]**2 - kt*q0*Q4[z+1,t] - 2*b*dt*Q2[z+1,t]*Q4[z+1,t] + 4*c*dt*Q1[z+1,t]*Q2[z+1,t]*Q4[z+1,t] + \
                                 4*c*dt*Q2[z+1,t]*Q4[z+1,t]**2 - kt*q0*Q4[z+1,t+1] - 2*b*dt*Q2[z+1,t+1]*Q4[z+1,t+1] + \
                                 4*c*dt*Q1[z+1,t+1]*Q2[z+1,t+1]*Q4[z+1,t+1] + 4*c*dt*Q2[z+1,t+1]*Q4[z+1,t+1]**2 - kt*q0*Q4[z+2,t-1] - kt*q0*Q4[z+2,t] - \
                                 kt*q0*Q4[z+2,t+1] - 2*b*dt*Q3[z-1,t-1]*Q5[z-1,t-1] + 4*c*dt*Q2[z-1,t-1]*Q5[z-1,t-1]**2 - \
                                 2*b*dt*Q3[z-1,t]*Q5[z-1,t] + 4*c*dt*Q2[z-1,t]*Q5[z-1,t]**2 - 2*b*dt*Q3[z-1,t+1]*Q5[z-1,t+1] + \
                                 4*c*dt*Q2[z-1,t+1]*Q5[z-1,t+1]**2 - 2*b*dt*Q3[z,t-1]*Q5[z,t-1] + 4*c*dt*Q2[z,t-1]*Q5[z,t-1]**2 - 2*b*dt*Q3[z,t]*Q5[z,t] + \
                                 4*c*dt*Q2[z,t]*Q5[z,t]**2 - 2*b*dt*Q3[z,t+1]*Q5[z,t+1] + 4*c*dt*Q2[z,t+1]*Q5[z,t+1]**2 - 2*b*dt*Q3[z+1,t-1]*Q5[z+1,t-1] + \
                                 4*c*dt*Q2[z+1,t-1]*Q5[z+1,t-1]**2 - 2*b*dt*Q3[z+1,t]*Q5[z+1,t] + 4*c*dt*Q2[z+1,t]*Q5[z+1,t]**2 - \
                                 2*b*dt*Q3[z+1,t+1]*Q5[z+1,t+1] + 4*c*dt*Q2[z+1,t+1]*Q5[z+1,t+1]**2))/dt

                GradE[5*t*Lz + 5*z + 2] = (dt*dz*(4*c*dt*Q3[z-1,t-1]**3 + 4*c*dt*Q3[z-1,t]**3 + \
                                2*dt*Q3[z-1,t-1]*(-a + b*Q4[z-1,t-1] + 2*c*\
                                (Q1[z-1,t-1]**2 + Q2[z-1,t-1]**2 + Q1[z-1,t-1]*Q4[z-1,t-1] + Q4[z-1,t-1]**2 + Q5[z-1,t-1]**2)) + \
                                2*dt*Q3[z-1,t]*(-a + b*Q4[z-1,t] + 2*c*(Q1[z-1,t]**2 + Q2[z-1,t]**2 + Q1[z-1,t]*Q4[z-1,t] + Q4[z-1,t]**2 + \
                                Q5[z-1,t]**2)) + 2*dt*(2*c*Q3[z-1,t+1]**3 + 2*c*Q3[z,t-1]**3 - a*Q3[z,t] + 2*c*Q1[z,t]**2*Q3[z,t] + 2*c*Q2[z,t]**2*Q3[z,t] + \
                                2*c*Q3[z,t]**3 - a*Q3[z,t+1] + 2*c*Q1[z,t+1]**2*Q3[z,t+1] + 2*c*Q2[z,t+1]**2*Q3[z,t+1] + 2*c*Q3[z,t+1]**3 - a*Q3[z+1,t-1] + \
                                2*c*Q1[z+1,t-1]**2*Q3[z+1,t-1] + 2*c*Q2[z+1,t-1]**2*Q3[z+1,t-1] + 2*c*Q3[z+1,t-1]**3 - a*Q3[z+1,t] + \
                                2*c*Q1[z+1,t]**2*Q3[z+1,t] + 2*c*Q2[z+1,t]**2*Q3[z+1,t] + 2*c*Q3[z+1,t]**3 - a*Q3[z+1,t+1] + \
                                2*c*Q1[z+1,t+1]**2*Q3[z+1,t+1] + 2*c*Q2[z+1,t+1]**2*Q3[z+1,t+1] + 2*c*Q3[z+1,t+1]**3 + b*Q3[z,t]*Q4[z,t] + \
                                2*c*Q1[z,t]*Q3[z,t]*Q4[z,t] + 2*c*Q3[z,t]*Q4[z,t]**2 + b*Q3[z,t+1]*Q4[z,t+1] + 2*c*Q1[z,t+1]*Q3[z,t+1]*Q4[z,t+1] + \
                                2*c*Q3[z,t+1]*Q4[z,t+1]**2 + b*Q3[z+1,t-1]*Q4[z+1,t-1] + 2*c*Q1[z+1,t-1]*Q3[z+1,t-1]*Q4[z+1,t-1] + \
                                2*c*Q3[z+1,t-1]*Q4[z+1,t-1]**2 + b*Q3[z+1,t]*Q4[z+1,t] + 2*c*Q1[z+1,t]*Q3[z+1,t]*Q4[z+1,t] + \
                                2*c*Q3[z+1,t]*Q4[z+1,t]**2 + b*Q3[z+1,t+1]*Q4[z+1,t+1] + 2*c*Q1[z+1,t+1]*Q3[z+1,t+1]*Q4[z+1,t+1] + \
                                2*c*Q3[z+1,t+1]*Q4[z+1,t+1]**2 - b*Q2[z-1,t-1]*Q5[z-1,t-1] - b*Q2[z-1,t]*Q5[z-1,t] - \
                                b*Q2[z-1,t+1]*Q5[z-1,t+1] + Q3[z-1,t+1]*\
                                (-a + b*Q4[z-1,t+1] + 2*c*(Q1[z-1,t+1]**2 + Q2[z-1,t+1]**2 + Q1[z-1,t+1]*Q4[z-1,t+1] + Q4[z-1,t+1]**2 + \
                                Q5[z-1,t+1]**2)) - b*Q2[z,t-1]*Q5[z,t-1] + \
                                Q3[z,t-1]*(-a + b*Q4[z,t-1] + 2*c*(Q1[z,t-1]**2 + Q2[z,t-1]**2 + Q1[z,t-1]*Q4[z,t-1] + Q4[z,t-1]**2 + \
                                Q5[z,t-1]**2)) - b*Q2[z,t]*Q5[z,t] + 2*c*Q3[z,t]*Q5[z,t]**2 - b*Q2[z,t+1]*Q5[z,t+1] + 2*c*Q3[z,t+1]*Q5[z,t+1]**2 - \
                                b*Q2[z+1,t-1]*Q5[z+1,t-1] + 2*c*Q3[z+1,t-1]*Q5[z+1,t-1]**2 - b*Q2[z+1,t]*Q5[z+1,t] + \
                                2*c*Q3[z+1,t]*Q5[z+1,t]**2 - b*Q2[z+1,t+1]*Q5[z+1,t+1] + 2*c*Q3[z+1,t+1]*Q5[z+1,t+1]**2) + \
                                kt*q0*(Q5[z-2,t-1] + Q5[z-2,t] + Q5[z-2,t+1] + Q5[z-1,t-1] + Q5[z-1,t] + Q5[z-1,t+1] - Q5[z+1,t-1] - \
                                Q5[z+1,t] - Q5[z+1,t+1] - Q5[z+2,t-1] - Q5[z+2,t] - Q5[z+2,t+1])))/dt

                GradE[5*t*Lz + 5*z + 3] = dt*dz*((kt*q0*(-Q2[z-2,t-1] + Q2[z,t-1]))/dt + (kt*q0*(-Q2[z-2,t] + Q2[z,t]))/dt + (kt*q0*(-Q2[z-2,t+1] + Q2[z,t+1]))/dt + \
                                 (kt*q0*(-Q2[z-1,t-1] + Q2[z+1,t-1]))/dt + (kt*q0*(-Q2[z-1,t] + Q2[z+1,t]))/dt + (kt*q0*(-Q2[z-1,t+1] + Q2[z+1,t+1]))/dt + \
                                 (kt*q0*(-Q2[z,t-1] + Q2[z+2,t-1]))/dt + (kt*q0*(-Q2[z,t] + Q2[z+2,t]))/dt + (kt*q0*(-Q2[z,t+1] + Q2[z+2,t+1]))/dt - \
                                 a*(Q1[z-1,t-1] + 2*Q4[z-1,t-1]) + b*(Q1[z-1,t-1]**2 - Q2[z-1,t-1]**2 + Q3[z-1,t-1]**2 + \
                                 2*Q1[z-1,t-1]*Q4[z-1,t-1]) - a*(Q1[z-1,t] + 2*Q4[z-1,t]) + \
                                 b*(Q1[z-1,t]**2 - Q2[z-1,t]**2 + Q3[z-1,t]**2 + 2*Q1[z-1,t]*Q4[z-1,t]) - a*(Q1[z-1,t+1] + 2*Q4[z-1,t+1]) + \
                                 b*(Q1[z-1,t+1]**2 - Q2[z-1,t+1]**2 + Q3[z-1,t+1]**2 + 2*Q1[z-1,t+1]*Q4[z-1,t+1]) - a*(Q1[z,t-1] + 2*Q4[z,t-1]) + \
                                 b*(Q1[z,t-1]**2 - Q2[z,t-1]**2 + Q3[z,t-1]**2 + 2*Q1[z,t-1]*Q4[z,t-1]) - a*(Q1[z,t] + 2*Q4[z,t]) + \
                                 b*(Q1[z,t]**2 - Q2[z,t]**2 + Q3[z,t]**2 + 2*Q1[z,t]*Q4[z,t]) - a*(Q1[z,t+1] + 2*Q4[z,t+1]) + \
                                 b*(Q1[z,t+1]**2 - Q2[z,t+1]**2 + Q3[z,t+1]**2 + 2*Q1[z,t+1]*Q4[z,t+1]) - a*(Q1[z+1,t-1] + 2*Q4[z+1,t-1]) + \
                                 b*(Q1[z+1,t-1]**2 - Q2[z+1,t-1]**2 + Q3[z+1,t-1]**2 + 2*Q1[z+1,t-1]*Q4[z+1,t-1]) - a*(Q1[z+1,t] + 2*Q4[z+1,t]) + \
                                 b*(Q1[z+1,t]**2 - Q2[z+1,t]**2 + Q3[z+1,t]**2 + 2*Q1[z+1,t]*Q4[z+1,t]) - a*(Q1[z+1,t+1] + 2*Q4[z+1,t+1]) + \
                                 b*(Q1[z+1,t+1]**2 - Q2[z+1,t+1]**2 + Q3[z+1,t+1]**2 + 2*Q1[z+1,t+1]*Q4[z+1,t+1]) + \
                                 2*c*(Q1[z-1,t-1] + 2*Q4[z-1,t-1])*(Q1[z-1,t-1]**2 + Q2[z-1,t-1]**2 + Q3[z-1,t-1]**2 + \
                                 Q1[z-1,t-1]*Q4[z-1,t-1] + Q4[z-1,t-1]**2 + Q5[z-1,t-1]**2) + \
                                 2*c*(Q1[z-1,t] + 2*Q4[z-1,t])*(Q1[z-1,t]**2 + Q2[z-1,t]**2 + Q3[z-1,t]**2 + Q1[z-1,t]*Q4[z-1,t] + Q4[z-1,t]**2 + \
                                 Q5[z-1,t]**2) + 2*c*(Q1[z-1,t+1] + 2*Q4[z-1,t+1])*\
                                 (Q1[z-1,t+1]**2 + Q2[z-1,t+1]**2 + Q3[z-1,t+1]**2 + Q1[z-1,t+1]*Q4[z-1,t+1] + Q4[z-1,t+1]**2 + Q5[z-1,t+1]**2)\
                                 + 2*c*(Q1[z,t-1] + 2*Q4[z,t-1])*(Q1[z,t-1]**2 + Q2[z,t-1]**2 + Q3[z,t-1]**2 + Q1[z,t-1]*Q4[z,t-1] + Q4[z,t-1]**2 + \
                                 Q5[z,t-1]**2) + 2*c*(Q1[z,t] + 2*Q4[z,t])*(Q1[z,t]**2 + Q2[z,t]**2 + Q3[z,t]**2 + Q1[z,t]*Q4[z,t] + Q4[z,t]**2 + Q5[z,t]**2) + \
                                 2*c*(Q1[z,t+1] + 2*Q4[z,t+1])*(Q1[z,t+1]**2 + Q2[z,t+1]**2 + Q3[z,t+1]**2 + Q1[z,t+1]*Q4[z,t+1] + Q4[z,t+1]**2 + \
                                 Q5[z,t+1]**2) + 2*c*(Q1[z+1,t-1] + 2*Q4[z+1,t-1])*\
                                 (Q1[z+1,t-1]**2 + Q2[z+1,t-1]**2 + Q3[z+1,t-1]**2 + Q1[z+1,t-1]*Q4[z+1,t-1] + Q4[z+1,t-1]**2 + Q5[z+1,t-1]**2)\
                                 + 2*c*(Q1[z+1,t] + 2*Q4[z+1,t])*(Q1[z+1,t]**2 + Q2[z+1,t]**2 + Q3[z+1,t]**2 + Q1[z+1,t]*Q4[z+1,t] + Q4[z+1,t]**2 + \
                                 Q5[z+1,t]**2) + 2*c*(Q1[z+1,t+1] + 2*Q4[z+1,t+1])*\
                                 (Q1[z+1,t+1]**2 + Q2[z+1,t+1]**2 + Q3[z+1,t+1]**2 + Q1[z+1,t+1]*Q4[z+1,t+1] + Q4[z+1,t+1]**2 + Q5[z+1,t+1]**2))

                GradE[5*t*Lz + 5*z + 4] = (dt*dz*(-(kt*q0*Q3[z-2,t-1]) - kt*q0*Q3[z-2,t] - kt*q0*Q3[z-2,t+1] - kt*q0*Q3[z-1,t-1] - \
                                 2*b*dt*Q2[z-1,t-1]*Q3[z-1,t-1] - kt*q0*Q3[z-1,t] - 2*b*dt*Q2[z-1,t]*Q3[z-1,t] - kt*q0*Q3[z-1,t+1] - \
                                 2*b*dt*Q2[z-1,t+1]*Q3[z-1,t+1] - 2*b*dt*Q2[z,t-1]*Q3[z,t-1] - 2*b*dt*Q2[z,t]*Q3[z,t] - 2*b*dt*Q2[z,t+1]*Q3[z,t+1] + \
                                 kt*q0*Q3[z+1,t-1] - 2*b*dt*Q2[z+1,t-1]*Q3[z+1,t-1] + kt*q0*Q3[z+1,t] - 2*b*dt*Q2[z+1,t]*Q3[z+1,t] + kt*q0*Q3[z+1,t+1] - \
                                 2*b*dt*Q2[z+1,t+1]*Q3[z+1,t+1] + kt*q0*Q3[z+2,t-1] + kt*q0*Q3[z+2,t] + kt*q0*Q3[z+2,t+1] - 2*a*dt*Q5[z-1,t-1] + \
                                 2*b*dt*Q1[z-1,t-1]*Q5[z-1,t-1] + 4*c*dt*Q1[z-1,t-1]**2*Q5[z-1,t-1] + 4*c*dt*Q2[z-1,t-1]**2*Q5[z-1,t-1] + \
                                 4*c*dt*Q3[z-1,t-1]**2*Q5[z-1,t-1] + 4*c*dt*Q1[z-1,t-1]*Q4[z-1,t-1]*Q5[z-1,t-1] + \
                                 4*c*dt*Q4[z-1,t-1]**2*Q5[z-1,t-1] + 4*c*dt*Q5[z-1,t-1]**3 - 2*a*dt*Q5[z-1,t] + 2*b*dt*Q1[z-1,t]*Q5[z-1,t] + \
                                 4*c*dt*Q1[z-1,t]**2*Q5[z-1,t] + 4*c*dt*Q2[z-1,t]**2*Q5[z-1,t] + 4*c*dt*Q3[z-1,t]**2*Q5[z-1,t] + \
                                 4*c*dt*Q1[z-1,t]*Q4[z-1,t]*Q5[z-1,t] + 4*c*dt*Q4[z-1,t]**2*Q5[z-1,t] + 4*c*dt*Q5[z-1,t]**3 - 2*a*dt*Q5[z-1,t+1] + \
                                 2*b*dt*Q1[z-1,t+1]*Q5[z-1,t+1] + 4*c*dt*Q1[z-1,t+1]**2*Q5[z-1,t+1] + 4*c*dt*Q2[z-1,t+1]**2*Q5[z-1,t+1] + \
                                 4*c*dt*Q3[z-1,t+1]**2*Q5[z-1,t+1] + 4*c*dt*Q1[z-1,t+1]*Q4[z-1,t+1]*Q5[z-1,t+1] + \
                                 4*c*dt*Q4[z-1,t+1]**2*Q5[z-1,t+1] + 4*c*dt*Q5[z-1,t+1]**3 - 2*a*dt*Q5[z,t-1] + 2*b*dt*Q1[z,t-1]*Q5[z,t-1] + \
                                 4*c*dt*Q1[z,t-1]**2*Q5[z,t-1] + 4*c*dt*Q2[z,t-1]**2*Q5[z,t-1] + 4*c*dt*Q3[z,t-1]**2*Q5[z,t-1] + \
                                 4*c*dt*Q1[z,t-1]*Q4[z,t-1]*Q5[z,t-1] + 4*c*dt*Q4[z,t-1]**2*Q5[z,t-1] + 4*c*dt*Q5[z,t-1]**3 - 2*a*dt*Q5[z,t] + \
                                 2*b*dt*Q1[z,t]*Q5[z,t] + 4*c*dt*Q1[z,t]**2*Q5[z,t] + 4*c*dt*Q2[z,t]**2*Q5[z,t] + 4*c*dt*Q3[z,t]**2*Q5[z,t] + \
                                 4*c*dt*Q1[z,t]*Q4[z,t]*Q5[z,t] + 4*c*dt*Q4[z,t]**2*Q5[z,t] + 4*c*dt*Q5[z,t]**3 - 2*a*dt*Q5[z,t+1] + 2*b*dt*Q1[z,t+1]*Q5[z,t+1] + \
                                 4*c*dt*Q1[z,t+1]**2*Q5[z,t+1] + 4*c*dt*Q2[z,t+1]**2*Q5[z,t+1] + 4*c*dt*Q3[z,t+1]**2*Q5[z,t+1] + \
                                 4*c*dt*Q1[z,t+1]*Q4[z,t+1]*Q5[z,t+1] + 4*c*dt*Q4[z,t+1]**2*Q5[z,t+1] + 4*c*dt*Q5[z,t+1]**3 - 2*a*dt*Q5[z+1,t-1] + \
                                 2*b*dt*Q1[z+1,t-1]*Q5[z+1,t-1] + 4*c*dt*Q1[z+1,t-1]**2*Q5[z+1,t-1] + 4*c*dt*Q2[z+1,t-1]**2*Q5[z+1,t-1] + \
                                 4*c*dt*Q3[z+1,t-1]**2*Q5[z+1,t-1] + 4*c*dt*Q1[z+1,t-1]*Q4[z+1,t-1]*Q5[z+1,t-1] + \
                                 4*c*dt*Q4[z+1,t-1]**2*Q5[z+1,t-1] + 4*c*dt*Q5[z+1,t-1]**3 - 2*a*dt*Q5[z+1,t] + 2*b*dt*Q1[z+1,t]*Q5[z+1,t] + \
                                 4*c*dt*Q1[z+1,t]**2*Q5[z+1,t] + 4*c*dt*Q2[z+1,t]**2*Q5[z+1,t] + 4*c*dt*Q3[z+1,t]**2*Q5[z+1,t] + \
                                 4*c*dt*Q1[z+1,t]*Q4[z+1,t]*Q5[z+1,t] + 4*c*dt*Q4[z+1,t]**2*Q5[z+1,t] + 4*c*dt*Q5[z+1,t]**3 + \
                                 2*dt*(-a + 2*c*Q1[z+1,t+1]**2 + Q1[z+1,t+1]*(b + 2*c*Q4[z+1,t+1]) + 2*c*(Q2[z+1,t+1]**2 + Q3[z+1,t+1]**2 + Q4[z+1,t+1]**2))*\
                                 Q5[z+1,t+1] + 4*c*dt*Q5[z+1,t+1]**3))/dt

    return(GradE)
